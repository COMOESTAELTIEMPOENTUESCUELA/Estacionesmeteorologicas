<!DOCTYPE html>
<html>
  <head>
    <title>Mapa de Estaciones con Leaflet y ThingSpeak</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  </head>
  <body>
    <h2>Estaciones de ThingSpeak en el Mapa</h2>
    <div id="map" style="height: 500px;"></div>
    <script>
      // Inicializa el mapa
      var map = L.map('map').setView([0, 0], 2);  // Vista inicial centrada en el mundo

      // Capa de OpenStreetMap
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      // URL de la API de ThingSpeak con el Channel ID proporcionado
      const url = 'https://api.thingspeak.com/channels/2685796/feeds.json?api_key=P3H82TMM9GH1NS26&results=2';

      // Realiza la solicitud a la API de ThingSpeak
      fetch(url)
        .then(response => response.json())
        .then(data => {
          // Obtiene los datos de la respuesta (temperatura y ubicación de las estaciones)
          const temperatura1 = data.feeds[0].field1; // Campo 1: Temperatura de la primera estación
          const latitud1 = parseFloat(data.feeds[0].location.latitude);  // Latitud de la estación 1
          const longitud1 = parseFloat(data.feeds[0].location.longitude); // Longitud de la estación 1

          const temperatura2 = data.feeds[1].field1; // Campo 1: Temperatura de la segunda estación
          const latitud2 = parseFloat(data.feeds[1].location.latitude);  // Latitud de la estación 2
          const longitud2 = parseFloat(data.feeds[1].location.longitude); // Longitud de la estación 2

          // Marca la primera estación en el mapa
          var marker1 = L.marker([latitud1, longitud1]).addTo(map);
          marker1.bindPopup(`<b>Estación 1</b><br>Temperatura: ${temperatura1}°C`).openPopup();

          // Marca la segunda estación en el mapa
          var marker2 = L.marker([latitud2, longitud2]).addTo(map);
          marker2.bindPopup(`<b>Estación 2</b><br>Temperatura: ${temperatura2}°C`).openPopup();

          // Centra el mapa en las dos estaciones
          map.fitBounds([ [latitud1, longitud1], [latitud2, longitud2] ]);
        })
        .catch(error => console.error('Error al obtener los datos de ThingSpeak:', error));
    </script>
  </body>
</html>

